sap.ui.define(["sap/ui/core/mvc/Controller","MDG/Help/util/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(t,e,a,o,i){"use strict";return t.extend("MDG.Help.controller.MasterQuotaion",{formatter:e,onInit:function(){var t=this;t.maxId=100+t.getOwnerComponent().getModel("customerInfo").getData().length;sap.ui.core.UIComponent.getRouterFor(this).getRoute("MasterQuotaion").attachPatternMatched(this._objPatternMatched,this)},_objPatternMatched:function(){this.handleMasterQuotationTableDetails()},onNavBack:function(){this.getView().getModel("appView").setProperty("/layout","OneColumn");this.getOwnerComponent().getRouter().navTo("Help")},handleOpenDialog:function(){if(!this.sortQuotationFragment){this.sortQuotationFragment=sap.ui.xmlfragment("MDG.Help.fragment.filterQuotation",this)}this.sortQuotationFragment.open()},onSearch:function(t){var e=new sap.ui.model.Filter("dCustomerName","Contains",t.getParameter("newValue"));var a=new sap.ui.model.Filter("id","EQ",t.getParameter("newValue"));var o=new sap.ui.model.Filter("dCustomer_ProjectName","Contains",t.getParameter("newValue"));var i=new sap.ui.model.Filter("DQuotation_Status","Contains",t.getParameter("newValue"));this.getView().byId("QuotationsTable").getBinding("items").filter(new sap.ui.model.Filter([e,a,o,i]))},handleConfirm:function(t){var e=t.getParameter("filterItems")[0].getProperty("key");var a="Draft";var o="Completed";var i="Value C";var r=new sap.ui.model.Filter("DQuotation_Status","Contains",a);var n=new sap.ui.model.Filter("DQuotation_Status","Contains",o);var s=new sap.ui.model.Filter("DQuotation_Status","Contains",i);if(e=="Draft")this.getView().byId("QuotationsTable").getBinding("items").filter(new sap.ui.model.Filter([r]));else if(e=="Completed")this.getView().byId("QuotationsTable").getBinding("items").filter(new sap.ui.model.Filter([n]));else this.getView().byId("QuotationsTable").getBinding("items").filter(new sap.ui.model.Filter([s]))},onPress:function(t){this.getView().getModel("appView").setProperty("/layout","OneColumn");var e=t.getSource().getBindingContext("QuotationMasterModel").sPath.split("/")[1];this.index=t.getSource().getBindingContext("QuotationMasterModel").getObject().customerId;this.projectId=t.getSource().getBindingContext("QuotationMasterModel").getObject().projectId;var a=t.getSource().getModel("QuotationMasterModel").getData()[e].id;this.getView().getModel("appView").updateBindings(true);this.getView().getModel("appView").setProperty("/indexNo",this.index);this.getView().getModel("appView").setProperty("/customerId",this.index);this.getView().getModel("appView").setProperty("/projectId",this.projectId);this.getView().getModel("appView").setProperty("/quotationId",a);this.getOwnerComponent().getRouter().navTo("quotationDetailAlone",{id:this.index,projectId:this.projectId,ModuleIndex:e,QuotationId:a})},handleMasterQuotationTableDetails:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-customer-quotations?populate=*&pagination[pageSize]=500",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){var a=e.data;if(e.data.length>0)var o=e.data;else var o=[];var i=[];for(var r=0;r<o.length;r++){i.push({projectId:o[r].attributes.d_customer_project.data===null?"":o[r].attributes.d_customer_project.data.id,customerId:o[r].attributes.d_customer.data===null?"":o[r].attributes.d_customer.data.id,id:o[r].id,dCustomerName:o[r].attributes.d_customer.data===null?"":o[r].attributes.d_customer.data.attributes.dCustomerName,dCustomer_ProjectName:o[r].attributes.d_customer_project.data==null?"":o[r].attributes.d_customer_project.data.attributes.dCustomer_ProjectName,DQuotation_Status:o[r].attributes.DQuotation_Status,createdAt:o[r].attributes.createdAt,dQuotation_Item_Price:o[r].attributes.dQuotation_Item_Price,dQuotation_Item_Quantity:o[r].attributes.dQuotation_Item_Quantity,publishedAt:o[r].attributes.publishedAt,updatedAt:o[r].attributes.updatedAt})}t.getView().setModel(new sap.ui.model.json.JSONModel(i),"QuotationMasterModel")}})}})});