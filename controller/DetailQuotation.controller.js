sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/model/Context","sap/ui/model/FilterOperator","sap/m/UploadCollectionParameter","sap/ui/model/Sorter"],function(e,t,i,a,o,n,s,l){"use strict";return e.extend("MDG.Customer.controller.DetailQuotation",{onInit:function(){this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.getOwnerComponent().getRouter().getRoute("DetailQuotation").attachPatternMatched(this.onObjectMatched,this);this.oDoc={fileName:"",mediaType:"",url:"",keyword:"",shortDescription:""};if(!this.viewQuatotionDetails){this.viewQuatotionDetails=new sap.ui.xmlfragment("MDG.Help.fragment.product",this)}},onSelectProduct:function(){var e=this;this.viewQuatotionDetails.open()},handleAddNewQuotationItemPress:function(){var e=this;this.getView().getModel("appView").setProperty("/layout","MidColumnFullScreen");this.getOwnerComponent().getRouter().navTo("Collection",{AddCust:"draft"})},handleproductCancelPress:function(){this.viewQuatotionDetails.close()},onObjectMatched:function(e){var t=this;t.detailPath=e.getParameter("arguments").sPath;var i=t.getOwnerComponent().getModel("Quotation").getData()[this.detailPath];this.getView().getModel("appView").setProperty("/status",i.status);var o=new a(i);t.getView().setModel(o)},___handleAddUserOkPress:function(){this.getOwnerComponent().getModel("customerInfo").getData().push(this.newcustomer);this.getOwnerComponent().getModel("customerInfo").updateBindings(true);this.getView().getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);this.getOwnerComponent().getRouter().navTo("Master");this.getView().getModel("appView").getData().lastId=this.getView().getModel("appView").getData().lastId+1},handleAddUserOkPress:function(){var e=this;var t=0;if(t==0){if(e.isAdd=="Edit"){this.getOwnerComponent().getModel("customerInfo").oData[e.getView().getModel("appView").oData.indexNo]=this.newcustomer;this.getOwnerComponent().getModel("customerInfo").updateBindings(true);this.getView().getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);var a=this.getView().getModel("appView").oData.tileIndex;this.getOwnerComponent().getRouter().navTo("Master",{id:a})}else{this.getOwnerComponent().getModel("customerInfo").getData().push(this.newcustomer);this.getOwnerComponent().getModel("customerInfo").updateBindings(true);this.getView().getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);var a=this.getView().getModel("appView").oData.tileIndex;this.getOwnerComponent().getRouter().navTo("Master",{id:a})}this.getView().getModel("appView").getData().lastId=this.getView().getModel("appView").getData().lastId+1}else{this.getView().setBusy(false);var o="Mandatory Fields are Required";i.error(o)}},handleWizardCancel:function(){this.getView().getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);this.getOwnerComponent().getRouter().navTo("Master",{id:tile})},handleDocumentUpload:function(){if(!this.AddDocumentFragment){this.AddDocumentFragment=sap.ui.xmlfragment("MDG.Customer.fragment.customerDocument",this);this.getView().addDependent(this.AddDocumentFragment)}this.AddDocumentFragment.open()},collectFileData:function(e){var t=e.getParameter("files")[0];this.fileData={fileName:t.name,mediaType:t.type,url:"",keyword:"",shortDescription:""}},handleAddDocumentOkPress:function(){this.fileData.keyword=this.AddDocumentFragment.getContent()[0].getContent()[1].getValue();this.fileData.shortDescription=this.AddDocumentFragment.getContent()[0].getContent()[2].getValue();this.getView().getModel().getData().documents.push(this.fileData);this.getView().getModel().updateBindings(true);this.handleAddUserCancelPress();t.show("Document added succesfuly.")},handleAddUserCancelPress:function(){this.AddDocumentFragment.close();this.clear()},clear:function(){this.fileData.keyword=this.AddDocumentFragment.getContent()[0].getContent()[1].setValue("");this.fileData.shortDescription=this.AddDocumentFragment.getContent()[0].getContent()[2].setValue("")},ValidateCreateCust:function(){var e=0;if(this.getView().byId("custName").getValue()==""||this.getView().byId("custName").getValue()===null){e++}else{this.getView().byId("custName").setValueState("None")}if(this.getView().byId("eml").getValue()==""||this.getView().byId("eml").getValue()===null){e++}else{this.getView().byId("eml").setValueState("None")}if(this.getView().byId("contNum").getValue()==""||this.getView().byId("contNum").getValue()===null){e++}else{this.getView().byId("contNum").setValueState("None")}if(this.getView().byId("abtCust").getValue()==""||this.getView().byId("abtCust").getValue()===null){e++}else{this.getView().byId("abtCust").setValueState("None")}if(this.getView().byId("addr").getValue()==""||this.getView().byId("addr").getValue()===null){e++}else{this.getView().byId("addr").setValueState("None")}if(this.getView().byId("cty").getValue()==""||this.getView().byId("cty").getValue()===null){e++}else{this.getView().byId("cty").setValueState("None")}if(this.getView().byId("crty").getValue()==""||this.getView().byId("cty").getValue()===null){e++}else{this.getView().byId("crty").setValueState("None")}return e},selectDocumentType:function(e){var i=this;var a=new sap.m.Panel;var o=new sap.m.HBox;o.addStyleClass("sapUiTinyMarginTop");var n=new sap.m.VBox;var s=new sap.m.Text({text:""});var l=new sap.ui.core.Item({key:"{Key}",text:"{Key}{Seperator}{Text}{Mandatory}",tooltip:"{Key}{Seperator}{Text}"});var r=new sap.m.UploadCollection({fileType:["jpg","png","jpeg","bmp"],maximumFilenameLength:55,maximumFileSize:1,multiple:false,sameFilenameAllowed:false,instantUpload:false,showSeparators:"All",noDataText:"No Data Found",change:function(e){i.onChange(e)},fileDeleted:function(e){i.onFileDeleted(e)},filenameLengthExceed:function(e){i.onFilenameLengthExceed(e)},fileSizeExceed:function(e){i.onFileSizeExceed(e)},typeMissmatch:function(e){i.onTypeMissmatch(e)},beforeUploadStarts:function(e){i.onBeforeUploadStarts(e)},uploadComplete:function(e){i.onUploadComplete(e)},uploadUrl:""});n.addItem(r);n.addStyleClass("sapUiTinyMargin");a.addContent(n);this.dialog=new sap.m.Dialog({title:"My Document",type:"Standard",resizable:true,contentWidth:"50%",contentHeight:"50%",state:"None",icon:"sap-icon://attachment",draggable:true,content:a,buttons:[new sap.m.Button({text:"Upload",press:function(){this.getView().byId("UploadSet").getModel().getData().documents.push(this.fileData);this.getView().byId("UploadSet").getModel().updateBindings(true);this.getView().getModel().getData().documents.push(this.fileData);this.getView().getModel().updateBindings(true);this.handleAddUserCancelPress();t.show("Document added succesfuly.")}}),new sap.m.Button({text:"Cancel",press:function(){i.dialog.close()}})],afterClose:function(){}});var d=this.dialog;i.dialog.open();if(sap.ui.Device.support.touch===false){i.dialog.addStyleClass("sapUiSizeCompact")}},onFileSizeExceed:function(e){sap.m.MessageToast.show("Please select less than 1 mb file");if(this.onFileSizeExceed_Exit){this.onFileSizeExceed_Exit()}},onTypeMissmatch:function(e){sap.m.MessageToast.show("Please Select Images");if(this.onTypeMissmatch_Exit){this.onTypeMissmatch_Exit()}},onFilenameLengthExceed:function(e){if(e.mParameters.mParameters.fileName.length>55){var t=oi18n.getText("File name Length Exceeded");oPPCCommon.displayMsg_MsgBox(this.getView(),t,"error")}if(this.onFilenameLengthExceed_Exit){this.onFilenameLengthExceed_Exit()}},onBeforeUploadStarts:function(e){var t=this.getCurrentUsers("MaterialDocDocuments","write");var i=new sap.m.UploadCollectionParameter({name:"x-arteria-loginid",value:t});var a;var o=new sap.m.UploadCollectionParameter({name:"helo",value:token});var n=this._oComponent.getModel("LocalViewSetting").getProperty("/DocType");vIndex++;var s=e.mParameters.fileName;SchemeGUID=this._oComponent.getModel("LocalViewSetting").getProperty("/GRDocGuid").toUpperCase();SchemeGUID=SchemeGUID.split("-").join("");var l=oPPCCommon.generateUUID().toUpperCase();l=l.split("-").join("");a=new sap.m.UploadCollectionParameter({name:"SLUG",value:"MaterialDocGUID:"+SchemeGUID+",DocumentStore:"+DocumentStore+",MatDocDocumentGUID:"+l+",DocumentTypeID:"+n+",FileName:"+s+",LoginID:"+t});e.getParameters().addHeaderParameter(o);e.getParameters().addHeaderParameter(i);e.getParameters().addHeaderParameter(a)},onUploadComplete:function(e){if(e.getParameter("files")[0].status===201){this.getContractDocumentss(this._oComponent,oi18n.getText("ContractAttachments.message.uploaded"))}else{var t="";var i=e.getParameter("files")[0].responseRaw}},onSelectionChange:function(e){var t=this;var i=e.getParameters().item.getKey();if(i=="collection"){this.getView().byId("selectedItemPreview").setVisible(true);this.getView().byId("collectionSelect").setVisible(true);this.getView().byId("colelctionText").setVisible(true);this.getView().byId("productSelect").setVisible(false);this.getView().byId("productText").setVisible(false);this.getView().byId("selectedItemPreview1").setVisible(false)}else{this.getView().byId("selectedItemPreview").setVisible(false);this.getView().byId("collectionSelect").setVisible(false);this.getView().byId("colelctionText").setVisible(false);this.getView().byId("selectedItemPreview1").setVisible(true);this.getView().byId("productSelect").setVisible(true);this.getView().byId("productText").setVisible(true)}},handleItemSelectionChange:function(e){var t=e.getSource().getSelectedItem().mProperties.key;var i=["Hudson","Chester","Hopper","Topanga"];for(var a=0;a<i.length;a++){if(t==i[a])this.getView().byId(i[a]).setVisible(true);else this.getView().byId(i[a]).setVisible(false)}},handleproductSelectionChange:function(e){var t=e.getSource().getSelectedItem().mProperties.key;var i=["Sofas","SideTables","DiningTables","BarTables"];for(var a=0;a<i.length;a++){if(t==i[a])this.getView().byId(i[a]).setVisible(true);else this.getView().byId(i[a]).setVisible(false)}},handleImagePress:function(){if(!this.AddTask){this.AddTask=sap.ui.xmlfragment("MDG.Help.fragment.AddTask",this);this.getView().addDependent(this.AddTask)}var e=[];var t=this.getOwnerComponent().getModel("customerInfo").getData()[this.path].products[0];var i=new sap.ui.model.json.JSONModel(t);this.AddTask.setModel(i);this.AddTask.open()},handleAddUserCancelPress:function(){this.AddTask.close()},handleAddTaskOkPress:function(){var e=[{prodName:this.AddTask.getContent()[0].getContent()[1].getText(),material:this.AddTask.getContent()[0].getContent()[3].getText(),loadCap:this.AddTask.getContent()[0].getContent()[5].getText(),modelNum:this.AddTask.getContent()[0].getContent()[7].getText(),dimention:this.AddTask.getContent()[0].getContent()[9].getText(),fabric:this.AddTask.getContent()[0].getContent()[11].getSelectedKey(),quantity:this.AddTask.getContent()[0].getContent()[13].getValue()}];var t=new a(e);this.getView().setModel(t,"quatData");this.AddTask.close()},addproduct:function(){var e=this;this.getView().getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getOwnerComponent().getRouter().navTo("Home",{test:"Edit"})},onSearch:function(e){var t=new sap.ui.model.Filter("QID","Contains",e.getParameter("newValue"));var i=new sap.ui.model.Filter("customerName","Contains",e.getParameter("newValue"));var a=new sap.ui.model.Filter("product","Contains",e.getParameter("newValue"));this.getView().byId("QuotationTable").getBinding("items").filter(new sap.ui.model.Filter([t,i,a],false))},handleSortfragment:function(){if(!this.sortcustomerFragment){this.sortcustomerFragment=sap.ui.xmlfragment("MDG.Help.fragment.sortQuotation",this)}this.sortcustomerFragment.open()},handleConfirm:function(e){var t=e.getParameter("sortItem");var i="id";var a=e.getParameter("sortDescending");var o=[];if(t){i=t.getKey()}o.push(new l(i,a));var n=this.getView().byId("QuotationTable");var s=n.getBinding("items");s.sort(o)},onNavBack:function(){this.getView().getModel("appView").setProperty("/layout","OneColumn");this.getOwnerComponent().getRouter().navTo("Help")},handleQuotationDetailPress:function(){var e=this;this.getView().getModel("appView").setProperty("/layout","MidColumnFullScreen");this.getOwnerComponent().getRouter().navTo("AddNewCustomer",{AddCust:"Edit"})},onCloseDetailPress:function(){var e=this;this.getView().getModel("appView").setProperty("/layout","MidColumnFullScreen");this.getOwnerComponent().getRouter().navTo("AddNewQuotation",{AddCust:"Edit"})},handleAddNewQuotationItemPress:function(){var e=this;this.getView().getModel("appView").setProperty("/layout","MidColumnFullScreen");this.getOwnerComponent().getRouter().navTo("Collection",{AddCust:"Draft",quotationId:this.detailPath})},handleDeleteQuotationPress:function(e){var t=this;this.deleteQuotation=e.getSource();sap.m.MessageBox.confirm("Do you want to delete the Item?",function(e){if(e=="OK"){t.deleteQuotation.getBindingContext().getModel().oData.Items.splice(t.deleteQuotation.getBindingContext().getPath().split("/")[2],1);t.deleteQuotation.getBindingContext().getModel().updateBindings(true)}})},downloadPDF:function(e){var t=this;t.getView().setBusy(true);window.setTimeout(function(){t.getView().byId("QuotationTable").setVisible(false);t.getView().byId("panelId").setVisible(true);var e=document.getElementById("container-Help---DetailQuotation--ObjectPageLayout");var i={margin:.5,filename:"Quotation",image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"},pagebreak:{mode:["css","legacy","avoid-all"]}};html2pdf().from(e).toPdf().get("pdf").then(function(a){html2pdf(e,i);window.setTimeout(function(){t.getView().byId("QuotationTable").setVisible(true);t.getView().byId("panelId").setVisible(false);t.getView().setBusy(false)},1e3)})},1500)},handleSubmitPress:function(){var e=this;sap.m.MessageBox.confirm("Do you want to submit the quotation?",function(t){if(t=="OK"){e.getView().getModel("appView").setProperty("/status","Submitted");e.getOwnerComponent().getModel("Quotation").getData()[e.detailPath].status="Submitted";e.getOwnerComponent().getModel("Quotation").updateBindings(true);e.getView().getModel("appView").setProperty("/layout","MidColumnFullScreen");e.getOwnerComponent().getRouter().navTo("AddNewQuotation",{AddCust:"Edit"})}})}})});