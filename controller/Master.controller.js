sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ui/model/Sorter"],function(t,e,a,o,s,n,r){"use strict";return t.extend("MDG.Help.controller.Master",{onInit:function(){var t=this;t.maxId=100+t.getOwnerComponent().getModel("customerInfo").getData().length;this.handleCustomerData();this.handleProjectData();sap.ui.core.UIComponent.getRouterFor(this).getRoute("Master").attachPatternMatched(this._objPatternMatched,this)},_objPatternMatched:function(){this.handleCustomerData();this.handleProjectData()},handleCustomerData:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-customers?populate=*",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){var a=[];for(var o=0;o<e.data.length;o++){if(e.data[o].attributes.d_customer_type.data!=undefined||e.data[o].attributes.d_customer_type.data!=null){var s=e.data[o].attributes.d_customer_type.data.id}else{var s=""}for(var n=0;n<5;n++){var r=n}var i={id:e.data[o].id,createdAt:e.data[o].attributes.createdAt,dBillingAddress:e.data[o].attributes.dBillingAddress,dCustomerName:e.data[o].attributes.dCustomerName,dOfficePhone:e.data[o].attributes.dOfficePhone,dWebsite:e.data[o].attributes.dWebsite,publishedAt:e.data[o].attributes.publishedAt,updatedAt:e.data[o].attributes.updatedAt,dCustomerContact_Name:e.data[o].attributes.d_customer_contacts.data.length>0?e.data[o].attributes.d_customer_contacts.data[0].attributes.dCustomerContact_Name:"",projectCount:e.data[o].attributes.d_customer_projects.data.length,customerContactId:s,customerQuotationId:e.data[o].attributes.d_customer_quotations.data.length>0?e.data[o].attributes.d_customer_quotations.data[0].id:"",projectId:e.data[o].attributes.d_customer_projects.data.length>0?e.data[o].attributes.d_customer_projects.data[0].id:r,customerProjects:e.data[o].attributes.d_customer_projects.data};a.push(i)}t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(a),"customerInfo");t.getView().setModel(new sap.ui.model.json.JSONModel(a),"customerModel");t.getView().getModel("customerModel").updateBindings(true)}})},onSearch:function(t){var o=this.getView().byId("userSearchId").getValue();var s=this.getView().byId("itemlistId").getBinding("items");if(o&&o.length>0){var n=new e("dCustomerName","Contains",o);var r=new e("dWebsite","Contains",o);var i=new e("id",a.EQ,o);var d=new e("dBillingAddress","Contains",o);var u=new e("dCustomerContact_Name","Contains",o);var g=[n,r,i,d,u];var c=new sap.ui.model.Filter(g,false);var l=[];l.push(c);s.filter(l)}else{var m=[];s.filter(m)}},onNavBack:function(){this.getView().getModel("appView").setProperty("/layout","OneColumn");this.getOwnerComponent().getRouter().navTo("Help")},__openAddNewCustomer:function(){this.getView().getModel("appView").setProperty("/layout","MidColumnFullScreen");this.getOwnerComponent().getRouter().navTo("AddNewCustomer")},openAddNewCustomer:function(){var t=this;this.getView().getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getView().getModel("appView").updateBindings(true);this.getOwnerComponent().getRouter().navTo("AddNewCustomer",{AddCust:"Add"})},handleUsersListPress:function(t){var e=[];for(var a=0;a<10;a++){e.push(a)}this.getView().getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.index=t.getSource().getSelectedContextPaths()[0].split("")[1];var o=t.getSource().getSelectedItem().getBindingContext("customerModel").getObject().id;this.projectId=t.getSource().getSelectedItem().getBindingContext("customerModel").getObject().projectId;this.getView().getModel("appView").setProperty("/projectId",this.projectId);this.newCustomerId=t.getSource().getSelectedItem().getBindingContext("customerModel").getObject().id;this.getView().getModel("appView").setProperty("/newCustomerId",this.newCustomerId);var s=t.getSource().getSelectedItem().getBindingContext("customerModel").getObject().customerQuotationId;this.getView().getModel("appView").setProperty("/customerQuotationId",s);this.customerContactId=t.getSource().getSelectedItem().getBindingContext("customerModel").getObject().customerContactId;this.getView().getModel("appView").setProperty("/customerContactId",this.customerContactId);this.getView().getModel("appView").setProperty("/CustomerProjectForIds",t.getSource().getSelectedItem().getBindingContext("customerModel").getObject().customerProjects);this.getView().getModel("appView").setProperty("/indexNo",this.index);this.getOwnerComponent().getRouter().navTo("Detail",{id:o,moduleIndex:this.index,newprojectId:this.projectId})},handleProjectData:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-customers?populate=*&filters[id][$eq]=24",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){if(e.data.length!=0&&e.data!=undefined){var a=e.data[0].attributes.d_customer_contacts.data;var o=[]}else{var s=[]}for(var n=0;n<a.length;n++){if(t.newCustomerId==a[n].id){var r={id:a[n].id,dCustomerContact_Name:a[n].attributes.dCustomerContact_Name,dCustomer_ContactEmail:a[n].attributes.dCustomer_ContactEmail,dCustomer_Conact_DirectPhone:a[n].attributes.dCustomer_Conact_DirectPhone,dCustomer_ContactMobile:a[n].attributes.dCustomer_ContactMobile,createdAt:a[n].attributes.createdAt,updatedAt:a[n].attributes.updatedAt,publishedAt:a[n].attributes.publishedAt}}}o.push(r);t.getOwnerComponent().setModel(new sap.ui.model.json.JSONModel(o),"ContactInfo")}})},handleSortfragment:function(){if(!this.sortcustomerFragment){this.sortcustomerFragment=sap.ui.xmlfragment("MDG.Help.fragment.sortCustomer",this)}this.sortcustomerFragment.open()},collectFileData:function(t){var e=t.getParameter("files")[0];this.fileData={fileName:e.name,mediaType:e.type,url:"",keyword:"",shortDescription:""}},__handleAddUserOkPress:function(){var t=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[0].getContent()[0].getContent();var e=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[1].getContent()[0].getContent();var a=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[2].getContent()[0].getContent();this.fileData.keyword=a[1].getValue();this.fileData.shortDescription=a[2].getValue();var s=this.maxId+1;var n={id:"CUST"+s,customerName:t[1].getValue(),email:t[3].getValue(),contact:t[5].getValue(),address:t[7].getValue(),contactPerson:e[1].getValue(),contactEmail:e[3].getValue(),contactPhone:e[5].getValue(),contactDesignation:e[7].getValue(),documents:[this.fileData]};var r=this.getView().getModel();var i=r.getData();i.push(n);r.updateBindings(true);this.maxId++;this.handleWizardCancel();o.show("New Customer added succesfuly.")},handleAddUserOkPress:function(){var t=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[0].getContent()[0].getContent();var e=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[1].getContent()[0].getContent();var a=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[2].getContent()[0].getContent();this.fileData.keyword=a[1].getValue();this.fileData.shortDescription=a[2].getValue();var s=this.maxId+1;var n={id:"CUST"+s,customerName:t[1].getValue(),email:t[3].getValue(),contact:t[5].getValue(),address:t[7].getValue(),contactPerson:e[1].getValue(),contactEmail:e[3].getValue(),contactPhone:e[5].getValue(),contactDesignation:e[7].getValue(),documents:[this.fileData]};var r=this.getView().getModel();var i=r.getData();i.push(n);r.updateBindings(true);this.maxId++;this.handleWizardCancel();o.show("New Customer added succesfuly.")},handleWizardCancel:function(){this.AddcustomerFragment.close();this.clearData()},clearData:function(){var t=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[0].getContent()[0].getContent();var e=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[1].getContent()[0].getContent();var a=this.AddcustomerFragment.getContent()[0].getPages()[0].getContent()[0].getSteps()[2].getContent()[0].getContent();t[1].setValue("");t[3].setValue("");t[5].setValue("");t[7].setValue("");t[9].setValue("");e[1].setValue("");e[3].setValue("");e[5].setValue("");e[7].setValue("");a[1].setValue("");a[2].setValue("")},handleAddUserCancelPress:function(){this.AddcustomerFragment.close()},onDialogNextButton:function(){if(this._oWizard.getProgressStep().getValidated()){this._oWizard.nextStep()}this.handleButtonsVisibility()},handleConfirm:function(t){var e=t.getParameter("sortItem");var a="id";var o="dCustomerName";var s="dWebsite";var n=t.getParameter("sortDescending");var i=[];if(e){a=e.getKey();o=e.getKey();s=e.getKey()}i.push(new r(a,n));i.push(new r(o,n));i.push(new r(s,n));var d=this.getView().byId("itemlistId");var u=d.getBinding("items");u.sort(i)}})});