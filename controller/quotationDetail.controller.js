sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Context","MDG/Help/util/formatter","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(t,e,a,n,o,i){"use strict";return t.extend("MDG.Help.controller.quotationDetail",{formatter:a,onInit:function(){this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();var t=this;if(!this.newQuotation){this.newQuotation=sap.ui.xmlfragment("MDG.Help.fragment.createQuotation",this);this.getView().addDependent(this.newQuotation)}if(!this.quotationCart){this.quotationCart=sap.ui.xmlfragment("MDG.Help.fragment.AddtoCart",this);this.getView().addDependent(this.quotationCart)}this.getOwnerComponent().getRouter().getRoute("quotationDetail").attachPatternMatched(function(a){var n=t.getOwnerComponent().getModel("customerInfo");var o=t.getOwnerComponent().getModel("ContactInfo");t.path=a.getParameter("arguments").id;t.quotationId=a.getParameter("arguments").QuotationId;this.getView().getModel("appView").oData.RequestIdSelected=a.getParameter("arguments").id;var i=new e(n,"/"+t.path);t.getView().setModel(new sap.ui.model.json.JSONModel(i.getObject()));t.getView().setModel(new sap.ui.model.json.JSONModel([]),"cartItemSummary");t.handleQuotationDetail(a.getParameter("arguments").QuotationId);t.handleCustomerQuotation(a.getParameter("arguments").QuotationId);t.handleQuotationTableDetails(a.getParameter("arguments").id);t.newProjectId=a.getParameter("arguments").id;t.handleCollectionName();t.handleitemSummary();t.handleCustomerModel();t.customerId=t.getOwnerComponent().getModel("customerProjectInfo").oData!=undefined?t.getOwnerComponent().getModel("customerProjectInfo").oData[0].id:""},this);this.getOwnerComponent().getRouter().getRoute("quotationDetailAlone").attachPatternMatched(function(a){var n=t.getOwnerComponent().getModel("customerInfo");var o=t.getOwnerComponent().getModel("customerProjectInfo");t.path=a.getParameter("arguments").id;t.quotationId=a.getParameter("arguments").QuotationId;this.getView().getModel("appView").oData.RequestIdSelected=a.getParameter("arguments").id;var i=new e(n,"/"+t.path);t.getView().setModel(new sap.ui.model.json.JSONModel(i.getObject()));t.getView().setModel(new sap.ui.model.json.JSONModel([]),"cartItemSummary");t.handleQuotationDetail(a.getParameter("arguments").QuotationId);t.handleCustomerQuotation(a.getParameter("arguments").QuotationId);t.handleQuotationTableDetails(a.getParameter("arguments").projectId);t.newProjectId=a.getParameter("arguments").projectId;t.handleCollectionName();t.handleitemSummary();t.handleCustomerModel();t.customerId=a.getParameter("arguments").id},this);this.getOwnerComponent().getRouter().getRoute("quotationDetailProject").attachPatternMatched(function(a){var n=t.getOwnerComponent().getModel("customerInfo");t.path=a.getParameter("arguments").id;t.quotationId=a.getParameter("arguments").QuotationId;this.getView().getModel("appView").oData.RequestIdSelected=a.getParameter("arguments").id;var o=new e(n,"/"+t.path);t.getView().setModel(new sap.ui.model.json.JSONModel(o.getObject()));t.getView().setModel(new sap.ui.model.json.JSONModel([]),"cartItemSummary");t.handleQuotationDetail(a.getParameter("arguments").QuotationId);t.handleCustomerQuotation(a.getParameter("arguments").QuotationId);t.handleQuotationTableDetails(a.getParameter("arguments").id);t.newProjectId=a.getParameter("arguments").id;t.handleCollectionName();t.handleitemSummary();t.handleCustomerModel();t.customerId=t.getOwnerComponent().getModel("customerProjectInfo").oData!=undefined?t.getOwnerComponent().getModel("customerProjectInfo").oData[0].id:""},this)},handleQuotationTableDetails:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-customer-projects?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=t.data;if(t.data.length>0){var n=t.data[0].attributes.d_customer_quotations.data;var o=t.data[0].attributes.d_customer_contacts.data;var i=t.data}else{var o=[];var n=[]}var r=[],s=[],d=[];for(var u=0;u<n.length;u++){if(e.quotationId==n[u].id){r.push({id:n[u].id,DQuotation_Status:n[u].attributes.DQuotation_Status,createdAt:n[u].attributes.createdAt,dQuotation_Item_Price:n[u].attributes.dQuotation_Item_Price,dQuotation_Item_Quantity:n[u].attributes.dQuotation_Item_Quantity,publishedAt:n[u].attributes.publishedAt,updatedAt:n[u].attributes.updatedAt})}}e.getView().setModel(new sap.ui.model.json.JSONModel(r),"QuotationDataModel");e.getView().getModel("QuotationDataModel").updateBindings(true)}})},handleCustomerModel:function(){var t=this;var e=t.getOwnerComponent().getModel("DetailContactModel").oData;var a=[];for(var n=0;n<e.length;n++){a.push({id:e[n].id,dCustomerContact_Name:e[n].DCustomerContact_type.dCustomerContact_Name,dCustomer_ContactEmail:e[n].DCustomerContact_type.dCustomer_ContactEmail,dCustomer_Conact_DirectPhone:e[n].DCustomerContact_type.dCustomer_Conact_DirectPhone,dCustomer_ContactMobile:e[n].DCustomerContact_type.dCustomer_ContactMobile,createdAt:e[n].DCustomerContact_type.createdAt,updatedAt:e[n].DCustomerContact_type.updatedAt,publishedAt:e[n].DCustomerContact_type.publishedAt})}t.getView().setModel(new sap.ui.model.json.JSONModel(a),"QuotaionContactsModel");t.getView().getModel("QuotaionContactsModel").updateBindings(true)},handleCustomerModel_old:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-customers?populate=*&filters[id][$eq]="+t.customerId,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){if(e.data.length>0){var a=e.data[0].attributes.d_customer_contacts.data}else{a=[]}var n=[];for(var o=0;o<a.length;o++){if(t.customerId==a[o].id){n.push({id:a[o].id,dCustomerContact_Name:a[o].attributes.dCustomerContact_Name,dCustomer_ContactEmail:a[o].attributes.dCustomer_ContactEmail,dCustomer_Conact_DirectPhone:a[o].attributes.dCustomer_Conact_DirectPhone,dCustomer_ContactMobile:a[o].attributes.dCustomer_ContactMobile,createdAt:a[o].attributes.createdAt,updatedAt:a[o].attributes.updatedAt,publishedAt:a[o].attributes.publishedAt})}}t.getView().setModel(new sap.ui.model.json.JSONModel(n),"QuotaionContactsModel");t.getView().getModel("QuotaionContactsModel").updateBindings(true)}})},handleDeleteQuotationPress:function(t){t=this.getView().getModel("appView").getProperty("/quotationId");n.confirm("Do you want to delete the Quotation?",{title:"Confirm Deletion",icon:n.Icon.WARNING,actions:[n.Action.YES,n.Action.NO],emphasizedAction:n.Action.YES,onClose:function(e){if(e==="YES"){$.ajax({url:"/DanaoStrapi/api/d-customer-quotation-details/"+t,type:"DELETE",headers:{"content-type":"application/json"},dataType:"json",success:function(t){sap.m.MessageToast.show("Quotation has been deleted successfully!",{closeOnBrowserNavigation:false})}})}}})},onCloseDetailPress:function(){if(window.location.hash.split("/")[1]=="quotationDetailAlone"){this.getOwnerComponent().getRouter().navTo("MasterQuotaion",{id:"test",module:"module"})}else if(window.location.hash.split("/")[1]=="quotationDetailProject"){this.getOwnerComponent().getRouter().navTo("projectDetail",{id:this.newProjectId,newPro:"0",projectId:this.newProjectId})}else{var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("Detail",{id:this.customerId,moduleIndex:"0",newprojectId:this.newProjectId})}},onCloseQuotation:function(){this.newQuotation.close()},onPressAdd:function(){this.handleQuotationItemsDetail();this.newQuotation.getContent()[0].getContentLeft()[1].setSelectedKey(null);this.newQuotation.getContent()[0].getContentMiddle()[1].setSelectedKey(null);this.newQuotation.getBeginButton().setVisible(false);this.newQuotation.open()},handleCollectionName:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-collections?populate=*",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){var a=e.data;var n=[];for(var o=0;o<a.length;o++){a[o].attributes.id=a[o].id;n.push(a[o].attributes)}t.getView().setModel(new sap.ui.model.json.JSONModel(n),"collectionModel");t.getView().getModel("collectionModel").updateBindings(true)}})},handleSelectCollection:function(t){var e=this;e.collectionData=t.getSource().getSelectedItem().getBindingContext("collectionModel").getObject().d_products.data;var a=t.getSource().getSelectedItem().getBindingContext("collectionModel").getObject().d_product_types.data;var n=[];for(var o=0;o<a.length;o++){n.push({id:a[o].id,DProduct_Type:a[o].attributes.DProduct_Type})}e.getView().setModel(new sap.ui.model.json.JSONModel(n),"categoryModel")},handleSelectCategory:function(t){var e=this;e.categoryData=t.getSource().getSelectedItem().getBindingContext("categoryModel").getObject().id},onPressGo:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-products?populate=*",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){var a=e.data,n=[],o=[];for(var i=0;i<t.collectionData.length;i++){for(var r=0;r<a.length;r++){if(t.categoryData==null&&t.collectionData[i].attributes.DProduct_Name==a[r].attributes.DProduct_Name){n.push(a[r])}}}for(var s=0;s<a.length;s++){if(t.categoryData==a[s].attributes.d_product_type.data.id){o.push(a[s])}}var d=n;var u=o;e.data=d.concat(u);var g=0;t.newQuotation.getContent()[1].getContent()[0].removeAllContent();for(var l=0;l<e.data.length;l++){if(g==0){g++;var c=new sap.ui.layout.BlockLayoutRow;t.newQuotation.getContent()[1].getContent()[0].addContent(c)}else{g--}var C=new sap.ui.layout.BlockLayoutCell;var m=new sap.m.FlexBox({height:"3.5rem"});var p=new sap.ui.layout.VerticalLayout({});var h=new sap.m.ObjectIdentifier({title:e.data[l].attributes.DProduct_Name});h.addStyleClass("sapUiTinyMarginBottom");var f=new sap.m.Label({text:"Product Number : "+e.data[l].attributes.DProduct_Number,class:"sapUiSmallMarginBottom"});f.addStyleClass("sapUiSmallMarginBottom");var b=new sap.m.ObjectStatus({text:"Available",state:"Success"});p.addContent(h);p.addContent(f);p.addContent(b);m.addItem(p);var _=new sap.m.FlexBox({renderType:"Bare",justifyContent:"Center"});var D=new sap.m.Image({height:"15rem",width:"15rem",src:e.data[l].attributes.DProduct_Image.data[0].attributes.name});D.addStyleClass("QuotationImageClass");_.addItem(D);C.addContent(m);C.addContent(_);var y=new sap.m.Button({press:function(e){var a=e.getSource().getParent().getParent().getContent()[0].getItems()[0].getContent()[1].getText().split(" : ")[1];t.handleitemSummary(a);t.mode="CREATE";t.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].setSelectedIndex(-1);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[1].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[3].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[5].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[7].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].setValue(0)},icon:"sap-icon://cart-3",type:"Emphasized"});var w=new sap.m.FlexBox({alignItems:"Center",justifyContent:"End",items:new sap.m.ObjectListItem({number:Math.round(t.customerTypeArr/100*e.data[l].attributes.DProduct_Price_Grade_A),numberUnit:"USD",numberState:"Success"})});var S=new sap.m.HBox({items:[y,w]});w.addStyleClass("welcomePrice");C.addContent(S);c.addContent(C)}}})},handleCustomerQuotation:function(t){t=this.getView().getModel("appView").getProperty("/customerContactId");var e=this;$.ajax({url:"/DanaoStrapi/api/d-customer-types?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=t.data;e.customerTypeArr=[];for(var n=0;n<a.length;n++){e.customerTypeArr.push(a[n].attributes.dCustomer_Type_DiscStructure)}e.getView().getModel("appView").setProperty("/discountPrice",e.customerTypeArr[0]);e.getOwnerComponent().getModel("qCustomerTypeModels").oData=e.customerTypeArr;e.getOwnerComponent().getModel("qCustomerTypeModels").updateBindings(true)}})},handleQuotationItemsDetail:function(){var t=this;$.ajax({url:"/DanaoStrapi/api/d-products?populate=*",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){console.log(e.data);t.newQuotation.getContent()[1].getContent()[0].removeAllContent();var a=0;for(var n=0;n<e.data.length;n++){if(a==0){a++;var o=new sap.ui.layout.BlockLayoutRow;t.newQuotation.getContent()[1].getContent()[0].addContent(o)}else{a--}var i=new sap.ui.layout.BlockLayoutCell;var r=new sap.m.FlexBox({height:"3.5rem"});var s=new sap.ui.layout.VerticalLayout({});var d=new sap.m.ObjectIdentifier({title:e.data[n].attributes.DProduct_Name});d.addStyleClass("sapUiTinyMarginBottom");var u=new sap.m.Label({text:"Product Number : "+e.data[n].attributes.DProduct_Number,class:"sapUiSmallMarginBottom"});u.addStyleClass("sapUiSmallMarginBottom");var g=new sap.m.ObjectStatus({text:"Available",state:"Success"});s.addContent(d);s.addContent(u);s.addContent(g);r.addItem(s);var l=new sap.m.FlexBox({renderType:"Bare",justifyContent:"Center"});var c=new sap.m.Image({height:"15rem",width:"15rem",src:e.data[n].attributes.DProduct_Image.data[0].attributes.name});c.addStyleClass("QuotationImageClass");l.addItem(c);i.addContent(r);i.addContent(l);var C=new sap.m.Button({press:function(e){var a=e.getSource().getParent().getParent().getContent()[0].getItems()[0].getContent()[1].getText().split(" : ")[1];t.handleitemSummary(a);t.mode="CREATE";t.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].setSelectedIndex(-1);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[1].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[3].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[5].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[7].setVisible(false);t.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].setValue(0)},icon:"sap-icon://cart-3",type:"Emphasized"});var m=new sap.m.FlexBox({alignItems:"Center",justifyContent:"End",items:new sap.m.ObjectListItem({number:Math.round(t.customerTypeArr/100*e.data[n].attributes.DProduct_Price_Grade_A),numberUnit:"USD",numberState:"Success"})});var p=new sap.m.HBox({items:[C,m]});m.addStyleClass("welcomePrice");i.addContent(p);o.addContent(i)}}})},onCloseCart:function(){this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].setSelectedIndex(-1);this.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[1].setVisible(false);this.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[3].setVisible(false);this.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[5].setVisible(false);this.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[7].setVisible(false);this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].setValue(0);this.quotationCart.close()},handleitemSummary:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-products?populate=*&filters[DProduct_Number][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=t.data;var n=[],o=[];for(var i=0;i<a.length;i++){n.push(a[i].attributes)}if(n[0].d_finish.data==null){sap.m.MessageBox.error("Selected Product doesn't have the finishing Details to show")}else{e.selectedFinishId=n[0].d_finish.data.id;e.handleitemfinishes(e.selectedFinishId)}e.getOwnerComponent().getModel("quotationItemsDetial").oData=n;e.getOwnerComponent().getModel("quotationItemsDetial").updateBindings(true)}})},handleitemfinishes:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-finishes?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=t.data;var n=[],o=[],i=[],r=[],s=[],d=[];for(var u=0;u<a.length;u++){n.push(a[u].attributes)}if(n[0].d_accents.data.length==0){e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[4].setText("");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[15].setVisible(false)}else{e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[4].setText("Selection Display(Accent)");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[15].setVisible(true);e.selectedAccentId=n[0].d_accents.data[0].id;e.handleItemAccent(e.selectedAccentId)}if(n[0].d_frame_straps.data.length==0){e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[2].setText("");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[11].setVisible(false)}else{e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[2].setText("Selection Display(Straps)");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[11].setVisible(true);e.selectedStrapId=n[0].d_frame_straps.data[0].id;e.handleItemStraps(e.selectedStrapId)}if(n[0].d_frame_colors.data.length==0){e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[0].setText("");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[3].setVisible(false)}else{e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[0].setText("Selection Display(Frames)");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[3].setVisible(true);e.selectedFrameId=n[0].d_frame_colors.data[0].id;e.handleitemFrames(e.selectedFrameId)}for(var g=0;g<t.data[0].attributes.d_fabric_grades.data.length;g++){o.push({id:t.data[0].attributes.d_fabric_grades.data[g].id,DFabric_Grade:t.data[0].attributes.d_fabric_grades.data[g].attributes.DFabric_Grade})}if(t.data[0].attributes.d_fabric_grades.data.length==0){e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[6].setText("");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[23].setVisible(false)}else{e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[6].setText("Selection Display(Finishes)");e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[23].setVisible(true)}for(var l=0;l<t.data[0].attributes.d_batylines.data.length;l++){d.push({id:t.data[0].attributes.d_batylines.data[l].id,DBatyline_Name:t.data[0].attributes.d_fabric_grades.data[l].attributes.DBatyline_Name})}if(t.data[0].attributes.d_batylines.data.length==0){e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[19].setVisible(false)}else{e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[19].setVisible(true)}for(var c=0;c<t.data[0].attributes.d_frames.data.length;c++){i.push({id:t.data[0].attributes.d_frames.data[c].id,DFrame_Color:t.data[0].attributes.d_frames.data[c].attributes.DFrame_Color,DFrame_Material_Code:t.data[0].attributes.d_frames.data[c].attributes.DFrame_Material_Code,DFrame_Material_Name:t.data[0].attributes.d_frames.data[c].attributes.DFrame_Material_Name})}for(var C=0;C<t.data[0].attributes.d_frame_straps.data.length;C++){r.push({id:t.data[0].attributes.d_frame_straps.data[C].id,DFrame_Straps_Name:t.data[0].attributes.d_frame_straps.data[C].attributes.DFrame_Straps_Name,DFrame_Straps_Code:t.data[0].attributes.d_frame_straps.data[C].attributes.DFrame_Straps_Code})}for(var m=0;m<t.data[0].attributes.d_accents.data.length;m++){s.push({id:t.data[0].attributes.d_accents.data[m].id,DAccent_Name:t.data[0].attributes.d_accents.data[m].attributes.DAccent_Name,DAccent_Code:t.data[0].attributes.d_accents.data[m].attributes.DAccent_Code})}e.getView().setModel(new sap.ui.model.json.JSONModel(s),"accentModel");e.getView().getModel("accentModel").updateBindings(true);e.getView().setModel(new sap.ui.model.json.JSONModel(d),"batyLineModel");e.getView().getModel("batyLineModel").updateBindings(true);e.getView().setModel(new sap.ui.model.json.JSONModel(r),"strapsModel");e.getView().getModel("strapsModel").updateBindings(true);e.getView().setModel(new sap.ui.model.json.JSONModel(i),"framesModel");e.getView().getModel("framesModel").updateBindings(true);e.getView().setModel(new sap.ui.model.json.JSONModel(o),"quotationItemFinishes");e.getView().getModel("quotationItemFinishes").updateBindings(true);e.quotationCart.open()}})},handleitemFrames:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-frame-colors?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=[];for(var n=0;n<t.data.length;n++){a.push({id:t.data[n].id,DFrameColor:t.data[n].attributes.DFrameColor,name:window.location.origin+"/DanaoStrapi"+t.data[n].attributes.DFrameColor_Image.data[0].attributes.url})}e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[1].setVisible(true);e.getView().setModel(new sap.ui.model.json.JSONModel(a),"framesImageModel");e.getView().getModel("framesImageModel").updateBindings(true);e.quotationCart.open()}})},handleItemStraps:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-frame-straps?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=[];for(var n=0;n<t.data.length;n++){a.push({id:t.data[n].id,DFrame_Straps_Name:t.data[n].attributes.DFrame_Straps_Name,url:window.location.origin+"/DanaoStrapi"+t.data[n].attributes.DFrame_Straps_Image.data[0].attributes.url})}e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[3].setVisible(true);e.getView().setModel(new sap.ui.model.json.JSONModel(a),"frameStrapModel");e.getView().getModel("frameStrapModel").updateBindings(true)}})},handleItemAccent:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-accents?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=[];for(var n=0;n<t.data.length;n++){a.push({id:t.data[n].id,DAccent_Name:t.data[n].attributes.DAccent_Name,Image:window.location.origin+"/DanaoStrapi"+t.data[n].attributes.DAccent_Image.data[0].attributes.url})}e.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[5].setVisible(true);e.getView().setModel(new sap.ui.model.json.JSONModel(a),"framesAccentModel");e.getView().getModel("framesAccentModel").updateBindings(true)}})},handleGradeDisplay:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-fabric-grades?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(a){var n=a.data[0].attributes.d_fabrics.data;var o=[];for(var i=0;i<n.length;i++){o.push({id:n[i].id,DFabric_Code:n[i].attributes.DFabric_Code,DFabric_Name:n[i].attributes.DFabric_Name,createdAt:n[i].attributes.createdAt,publishedAt:n[i].attributes.publishedAt,updatedAt:n[i].attributes.updatedAt})}e.handleImageDisplay(t,o)}})},handleImageDisplay:function(t,e){var a=this;a.gradeArr=e;$.ajax({url:"/DanaoStrapi/api/d-fabrics?populate=*&pagination[pageSize]=100",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){for(var e=0;e<a.gradeArr.length;e++){for(var n=0;n<t.data.length;n++){if(t.data[n].attributes.DFabric_Code==a.gradeArr[e].DFabric_Code){if(t.data[n].attributes.DFabric_Image.data[0].attributes.name.indexOf("https")!=-1)a.gradeArr[e]["imageUrl"]=t.data[n].attributes.DFabric_Image.data[0].attributes.name;else a.gradeArr[e]["imageUrl"]=window.location.origin+"/DanaoStrapi"+t.data[n].attributes.DFabric_Image.data[0].attributes.formats.thumbnail.url;a.gradeArr[e]["thumbNail"]=t.data[n].attributes.DFabric_Image.data[0].attributes.url;break}}}a.quotationCart.getContent()[1].getContent()[0].getContent()[1].getContent()[0].getContent()[7].setVisible(true);a.getOwnerComponent().getModel("fabricModel").oData=a.gradeArr;a.getOwnerComponent().getModel("fabricModel").updateBindings(true)}})},handleGradeButtonSelect:function(t){var e=this;e.selectedData=t.getSource().getSelectedButton().getBindingContext("quotationItemFinishes").getObject().id;if(e.selectedData===1){e.handleGradeDisplay(e.selectedData)}else if(e.selectedData===2){e.handleGradeDisplay(e.selectedData)}else if(e.selectedData===3){e.handleGradeDisplay(e.selectedData)}else{}},onPressAddtoCart:function(t){var e=this;e.selectedEditPath=t.getSource().getBindingContext("cartItemSummary").sPath.split("/")[1];e.selectedProductPrice=t.getSource().getModel("cartItemSummary").oData[t.getSource().getBindingContext("cartItemSummary").sPath.split("/")[1]].dProduct_Total_Price;e.selectedQuantity=t.getSource().getModel("cartItemSummary").oData[t.getSource().getBindingContext("cartItemSummary").sPath.split("/")[1]].Qty;var a=t.getSource().getBindingContext("cartItemSummary").getObject().grade;var n=t.getSource().getBindingContext("cartItemSummary").getObject().dProduct_Thumbnail;var o=t.getSource().getBindingContext("cartItemSummary").getObject().dProduct_Name;var i=e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].getButtons();for(var r=0;r<i.length;r++){if(a==i[r].getBindingContext("quotationItemFinishes").getObject().DFabric_Grade){var s=i[r].getBindingContext("quotationItemFinishes").getObject().id;e.handleGradeDisplay(s);e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].setSelectedIndex(r)}}var d=t.getSource().getBindingContext("cartItemSummary").getObject().Qty;if(d){e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].setValue(d)}else{e.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].setValue(0)}if(n){e.quotationCart.getContent()[0].getContent()[0].getContent()[1].getContent()[1].getPages()[0].getItems()[0].setSrc(n)}else{e.quotationCart.getContent()[0].getContent()[0].getContent()[1].getContent()[1].getPages()[0].getItems()[0].getSrc()}e.quotationCart.getContent()[0].getParent().setTitle(o);e.quotationCart.open();e.mode="EDIT"},onPressDeleteItem:function(t){var e=this;e.selectedPath=t.getSource().getBindingContext("cartItemSummary").sPath.split("/")[1];n.confirm("Do you want to delete the Item?",{title:"Confirm Deletion",icon:n.Icon.WARNING,actions:[n.Action.YES,n.Action.NO],emphasizedAction:n.Action.YES,onClose:function(t){if(t==="YES"){e.getView().getModel("cartItemSummary").oData.splice(e.selectedPath,1);e.getView().getModel("cartItemSummary").updateBindings(true);sap.m.MessageToast.show("Quotation Deleted sucessfully",{closeOnBrowserNavigation:false});$.ajax({url:"/DanaoStrapi/api/d-customer-quotations?populate=*&filters[id][$eq]="+e.quotationId,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=[];var n=t.data[0].attributes.d_customer_quotation_details.data;for(var o=0;o<n.length;o++)a.push(n[o]);var i=a[e.selectedPath].id;$.ajax({url:"/DanaoStrapi/api/d-customer-quotation-details/"+i,type:"DELETE",headers:{"content-type":"application/json"},dataType:"json",success:function(t){e.handleQuotationDetail(e.quotationId);sap.m.MessageToast.show("Quotation Deleted sucessfully",{closeOnBrowserNavigation:false})}})}})}}})},handleAddCartPress:function(t){var e=this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].getButtons();var a=this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue();var n=this.getView().getModel("appView").getProperty("/totalAmount");for(var o=0;o<e.length;o++){if(e[o].getBindingContext("quotationItemFinishes").getObject().id===1){var i=Math.round(this.customerTypeArr/100*this.getView().getModel("quotationItemsDetial").oData[0].DProduct_Price_Grade_A)}else if(e[o].getBindingContext("quotationItemFinishes").getObject().id===2){i=Math.round(this.customerTypeArr/100*this.getView().getModel("quotationItemsDetial").oData[0].DProduct_Price_GradeB)}else{}}n=i*a;if(this.mode=="EDIT"){this.cartObjUpdated={itemDetails:this.getView().getModel("quotationItemsDetial").oData[0],frame:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[4].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[4].getSelectedButton().getText():"",straps:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[12].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[12].getSelectedButton().getText():"",accent:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[16].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[16].getSelectedButton().getText():"",grade:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].getSelectedButton().getText():"",dProduct_UnitPrice:i!=undefined?Math.round(this.customerTypeArr/100*i):"",dProduct_Total_Price:n!=undefined?Math.round(this.customerTypeArr/100*n):"",Qty:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue(),SKU:"33230110"+this.getView().getModel("cartItemSummary").oData.length,fabricType:this.selectedFabric!=undefined?this.selectedFabric:"",fabricName:this.selectedFabric!=undefined?this.selectedFabric.DFabric_Name:"",imageUrl:this.selectedFabric!=undefined?this.selectedFabric.imageUrl:"",frameImage:this.selectedFrame!=undefined?this.selectedFrame:"",strapImage:this.selectedStrap!=undefined?this.selectedStrap:"",accentImage:this.selectedAccent!=undefined?this.selectedAccent:"",frameColor:this.selectedFrameColor!=undefined?this.selectedFrameColor:"",createdAt:this.selectedFabric!=undefined?this.selectedFabric.createdAt:"",fabricId:this.selectedFabric!=undefined?this.selectedFabric.id:"",dProduct_Name:this.getView().getModel("quotationItemsDetial").oData[0]!=undefined?this.getView().getModel("quotationItemsDetial").oData[0].DProduct_Name:"",dProduct_Thumbnail:this.getView().getModel("quotationItemsDetial").oData[0]!=undefined?this.getView().getModel("quotationItemsDetial").oData[0].DProduct_Image.data[0].attributes.name:""};var r=this.getView().getModel("appView").getProperty("/totalAmount");r+=this.cartObjUpdated.dProduct_Total_Price-this.selectedProductPrice;var s=this.getView().getModel("appView").getProperty("/qty");s+=this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue()-this.selectedQuantity;this.getView().getModel("appView").setProperty("/totalAmount",r);this.getView().getModel("appView").setProperty("/qty",s);if(this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue()>0){this.getView().getModel("cartItemSummary").oData[this.selectedEditPath]=this.cartObjUpdated;this.getView().getModel("cartItemSummary").updateBindings(true);this.quotationCart.close()}else sap.m.MessageBox.error("Please enter the quantity")}else if(this.mode=="CREATE"){var d={itemDetails:this.getView().getModel("quotationItemsDetial").oData[0],frame:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[4].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[4].getSelectedButton().getText():"",straps:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[12].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[12].getSelectedButton().getText():"",accent:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[16].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[16].getSelectedButton().getText():"",grade:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].getSelectedButton()!=undefined?this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[24].getSelectedButton().getText():"",dProduct_UnitPrice:i!=undefined?Math.round(this.customerTypeArr/100*i):"",dProduct_Total_Price:n!=undefined?Math.round(this.customerTypeArr/100*n):"",Qty:this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue(),SKU:"33230110"+this.getView().getModel("cartItemSummary").oData.length,fabricType:this.selectedFabric!=undefined?this.selectedFabric:"",fabricName:this.selectedFabric!=undefined?this.selectedFabric.DFabric_Name:"",imageUrl:this.selectedFabric!=undefined?this.selectedFabric.imageUrl:"",frameImage:this.selectedFrame!=undefined?this.selectedFrame:"",strapImage:this.selectedStrap!=undefined?this.selectedStrap:"",accentImage:this.selectedAccent!=undefined?this.selectedAccent:"",frameColor:this.selectedFrameColor!=undefined?this.selectedFrameColor:"",createdAt:this.selectedFabric!=undefined?this.selectedFabric.createdAt:"",fabricId:this.selectedFabric!=undefined?this.selectedFabric.id:"",dProduct_Name:this.getView().getModel("quotationItemsDetial").oData!=undefined?this.getView().getModel("quotationItemsDetial").oData[0].DProduct_Name:"",dProduct_Thumbnail:this.getView().getModel("quotationItemsDetial").oData!=undefined?this.getView().getModel("quotationItemsDetial").oData[0].DProduct_Image.data[0].attributes.name:""};var u=this.getView().getModel("appView").getProperty("/totalAmount");u+=Math.round(this.customerTypeArr/100*d.dProduct_Total_Price);var g=this.getView().getModel("appView").getProperty("/qty");g+=this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue();this.getView().getModel("appView").setProperty("/totalAmount",u);this.getView().getModel("appView").setProperty("/qty",g);if(this.quotationCart.getContent()[1].getContent()[0].getContent()[0].getContent()[0].getContent()[8].getValue()>0){this.getView().getModel("cartItemSummary").oData.push(d);sap.m.MessageToast.show("Item is added to the cart");this.getView().getModel("cartItemSummary").updateBindings(true);this.quotationCart.close()}else sap.m.MessageBox.error("Please enter the quantity")}},handleDraftItemSummaryPress:function(t){var e=this;var a=e.getView().getModel("cartItemSummary").oData;e.servicecall=0;e.quotationDetailArr=[];for(var n=0;n<a.length;n++){var o={data:{dProduct_SKU:a[n].SKU,dProduct_Quantity:a[n].Qty+"",d_frames:a[n].frame,d_frame_straps:a[n].straps,d_ropes:"",d_batylines:"",d_accents:a[n].accent,d_frame_tops:"",d_weaves:"",createdAt:a[n].createdAt,d_fabric_grades:a[n].grade,d_Quotation_ProdNotes:"",dFabric_ID:a[n].fabricId!=undefined?a[n].fabricId.toString():"",dProduct_UnitPrice:a[n].dProduct_UnitPrice!=undefined?a[n].dProduct_UnitPrice.toString():"",dProduct_Total_Price:a[n].dProduct_Total_Price!=undefined?a[n].dProduct_Total_Price.toString():"",dProduct_Name:a[n].itemDetails!=undefined?a[n].itemDetails.DProduct_Name:"",dProduct_Thumbnail:a[n].itemDetails!=undefined?a[n].itemDetails.DProduct_Image.data[0].attributes.name:""}};$.ajax({url:"/DanaoStrapi/api/d-customer-quotation-details",type:"POST",headers:{"content-type":"application/json"},data:JSON.stringify(o),dataType:"json",success:function(t){e.servicecall++;var n=t.data.id;e.quotationDetailArr.push(t.data.id);if(a.length==e.servicecall)e.handleUpdateQuotationItemAfterPost(o,e.quotationId,n);sap.m.MessageBox.success("Quotation has been created successfully")},error:function(t){var e=t}})}},handleUpdateQuotationItemAfterPost:function(t,e,a){var o=this;$.ajax({url:"/DanaoStrapi/api/d-customer-quotations?populate=*&filters[id][$eq]="+o.quotationId,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(e){var i=e.data[0].attributes.d_customer_quotation_details.data;var r=[];for(var s=0;s<i.length;s++){r.push(i[s].id)}r.push(a);t={data:{d_customer_quotation_details:r}};$.ajax({url:"/DanaoStrapi/api/d-customer-quotations/"+o.quotationId,type:"PUT",headers:{"content-type":"application/json"},data:JSON.stringify(t),dataType:"json",success:function(t){o.handleQuotationDetail(o.quotationId)},error:function(t){n.error(t.responseJSON.error.message)}})}})},handleQuotationDetail:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-products?populate=*",type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(a){e.products=a.data;var n=[];e.handleQuotationProducts(t)}})},handleQuotationProducts:function(t){var e=this;$.ajax({url:"/DanaoStrapi/api/d-customer-quotations?populate=*&filters[id][$eq]="+t,type:"GET",headers:{"content-type":"application/json"},dataType:"json",success:function(t){var a=t.data[0].attributes.d_customer_quotation_details.data;var n=[];for(var o=0;o<a.length;o++){for(var i=0;i<e.products.length;i++){if(e.products[i].attributes.DProduct_Name==a[o].attributes.dProduct_Name){a[o].attributes["itemDetails"]=e.products[i];e.productNumber=e.products[i].attributes.DProduct_Number;n.push({id:a[o].id,createdAt:a[o].attributes.createdAt,dFabric_ID:a[o].attributes.dFabric_ID,Qty:a[o].attributes.dProduct_Quantity+"",SKU:a[o].attributes.dProduct_SKU,dProduct_UnitPrice:a[o].attributes.dProduct_UnitPrice,dProduct_Total_Price:a[o].attributes.dProduct_Total_Price,d_Quotation_ProdNotes:a[o].attributes.d_Quotation_ProdNotes,accent:a[o].attributes.d_accents,d_batylines:a[o].attributes.d_batylines,grade:a[o].attributes.d_fabric_grades,straps:a[o].attributes.d_frame_straps,d_frame_tops:a[o].attributes.d_frame_tops,frame:a[o].attributes.d_frames,d_ropes:a[o].attributes.d_ropes,d_weaves:a[o].attributes.d_weaves,dProduct_Name:a[o].attributes.dProduct_Name,dProduct_Thumbnail:a[o].attributes.dProduct_Thumbnail})}}}e.getView().getModel("cartItemSummary").oData=n;e.getView().getModel("cartItemSummary").updateBindings(true)}})},handleFabricSelection:function(t){sap.m.MessageToast.show("Fabric "+t.getSource().getBindingContext("fabricModel").getObject().DFabric_Name+" is selected");this.selectedFabric=t.getSource().getBindingContext("fabricModel").getObject()},handleFrameSelection:function(t){sap.m.MessageToast.show(t.getSource().getBindingContext("framesImageModel").getObject().DFrameColor+" is selected");this.selectedFrame=t.getSource().getBindingContext("framesImageModel").getObject().name;this.selectedFrameColor=t.getSource().getBindingContext("framesImageModel").getObject().DFrameColor},handleStrapSelection:function(t){sap.m.MessageToast.show(t.getSource().getBindingContext("frameStrapModel").getObject().DFrame_Straps_Name+" is selected");this.selectedStrap=t.getSource().getBindingContext("frameStrapModel").getObject().url},handleAccentSelection:function(t){sap.m.MessageToast.show(t.getSource().getBindingContext("framesAccentModel").getObject().DAccent_Name+" is selected");this.selectedAccent=t.getSource().getBindingContext("framesAccentModel").getObject().Image},onSearch:function(t){var e=new sap.ui.model.Filter("dProduct_Name","Contains",t.getParameter("newValue"));var a=new sap.ui.model.Filter("SKU","Contains",t.getParameter("newValue"));var n=new sap.ui.model.Filter("grade","Contains",t.getParameter("newValue"));var o=new sap.ui.model.Filter("frame","Contains",t.getParameter("newValue"));var i=new sap.ui.model.Filter([e,a,n,o],false);this.getView().byId("tableItemsId").getBinding("items").filter(i)}})});